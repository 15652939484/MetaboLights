<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<script src="../../third-party/closure/closure/goog/base.js"></script>
<script src="../deps.js"></script>
<script src="../../specviewTest/data/specData/cmlfile.js"></script>

<script>
    goog.require('goog.events.EventType');
    goog.require('goog.ui.Select');
    goog.require('specview.controller.Controller');
    goog.require('specview.controller.plugins.Highlight');
    goog.require('specview.io.SpectrumCMLParser');
    goog.require('specview.model.NMRdata');
</script>

<script>

function initPage(){
		
	// uncomment next two lines to debug to console
	var c = new goog.debug.Console(); 
	c.setCapturing(true); 
	
	//Create the canvas and provide it with highlight plugins
	var editor = new specview.controller.Controller(goog.dom.getElement('moleculeContainer'),{background : {color : 'white'}});
	editor.registerPlugin(new specview.controller.plugins.Highlight());

	//Initialisation of a molecule to display when the page is loading
	var cmlData=cmlmolecules.split("$$END$$\n");
	var xmlDoc=specview.io.SpectrumCMLParser.getDocument(cmlData[0]);//XML document
	var spectrumData=new specview.model.NMRdata();
	spectrumData.setEditor(editor);
	spectrumData=specview.io.SpectrumCMLParser.parseDocument(spectrumData,xmlDoc);//a cmlObject
	spectrumData.setCoordinatesWithPixels()//PASSS the graphics
	//CAREFUL WITH THE FOLLOWING LINE
	editor.setSpecObject(spectrumData);
	editor.setModels([spectrumData]);


	
	
	//Creation of the tool bar
    var select1 = new goog.ui.Select();
    select1.addItem(new goog.ui.MenuItem('0', 0));
    select1.addItem(new goog.ui.MenuItem('1', 1));
    select1.addItem(new goog.ui.MenuItem('2', 2));
    select1.addItem(new goog.ui.MenuItem('3', 3));
    select1.addItem(new goog.ui.MenuItem('4', 4));
    select1.addItem(new goog.ui.MenuItem('5', 5));

    select1.setSelectedIndex(0);
    select1.render(goog.dom.getElement('selectMolecule'));
    
    goog.events.listen(select1, goog.ui.Component.EventType.ACTION,
    function(e) {
      var select = e.target;
      var idx = select.getValue();
      if(cmlData[idx]==undefined){
          alert("NO SUCH MOLECULE IN THE ARRAY! Default molecle will be displayed : ")
          idx=0;
      }
      var molfile=cmlData[idx];
      var xmlDoc=specview.io.SpectrumCMLParser.getDocument(molfile);//XML document
      var spectrumData=new specview.model.NMRdata();
      spectrumData.setEditor(editor);	
      spectrumData=specview.io.SpectrumCMLParser.parseDocument(spectrumData,xmlDoc);//a cmlObject
	  spectrumData.setCoordinatesWithPixels()
	//CAREFUL WITH THE FOLLOWING LINE
//	spectrumData.setCoordinatesWithPixels();
	  editor.setSpecObject(spectrumData);
      editor.setModels([spectrumData]);
    });
  };
  goog.events.listen(window, goog.events.EventType.LOAD, initPage);
 
</script>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Display spectrum demo</title>
	<link rel="stylesheet" href="../../css/specview.css" />
	<link rel="stylesheet"  href="../../css/demo.css" />
</head>

<body>

	<fieldset style="width:1200px">
        <legend><h1>Spectrum viewer</h1></legend>
        <br>
        <label id="selectMolecule">Select a spectrum to render: </label>
        <br>
        <div id="moleculeContainer" style="height:400px"></div>
	</fieldset>


</body>
</html>

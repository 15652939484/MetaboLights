<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<script src="../../third-party/closure/closure/goog/base.js"></script>
<script src="../deps.js"></script>
<script src="../../specviewTest/data/cmlfile.js"></script>
<script>
    goog.require('goog.events.EventType');
    goog.require('goog.ui.Select');
    goog.require('specview.controller.Controller');
    goog.require('specview.controller.plugins.Highlight');
    goog.require('specview.controller.plugins.Zoom');
    goog.require('specview.io.SpectrumCMLParser');
    goog.require('specview.model.NMRdata');
    goog.require('goog.events.MouseWheelHandler');
    goog.require('goog.fx.Dragger');
    goog.require('goog.dom');
    goog.require('goog.math');
    goog.require('goog.ui.DragDropDetector');
    goog.require('goog.style');
    goog.require('goog.graphics');
</script>

<script>

//editor=null;
spectrumData=null;
zoom=0;

document.atomSensitivity = 6;
document.bondSensitivity = 6;
document.peakSensitivity = 10;

function initPage(){
			var isGrid=false;
			var isAxis=false;
			// uncomment next two lines to debug to console						
			var c = new goog.debug.Console(); 
			c.setCapturing(true); 
			
			
//			var toolbar = new specview.controller.DefaultToolbar.makeDefaultMoleculeToolbar(goog.dom.getElement('moleculeEditorToolbar'));  
			
			var cmlData=cmlmolecules.split("$$END$$\n");
			var xmlDoc=specview.io.SpectrumCMLParser.getDocument(cmlData[1]);//XML document
			spectrumData=new specview.model.NMRdata();
			spectrumData=specview.io.SpectrumCMLParser.parseDocument(spectrumData,xmlDoc,navigator.appName);//a cmlObject
			
			//Create the canvas and provide it with highlight plugins
			editor = new specview.controller.Controller(goog.dom.getElement('moleculeContainer'),{background : {color : 'white'}});
			editor.registerPlugin(new specview.controller.plugins.Highlight());
			editor.registerPlugin(new specview.controller.plugins.Zoom());
//			editor.registerPlugin(new specview.controller.plugins.BondEdit());
			spectrumData.editor=editor;

			spectrumData.setCoordinatesWithPixels(editor)

			editor.setSpecObject(spectrumData);
			document.metaSpecObject = spectrumData;

			
			editor.setModels([spectrumData],false);
			editor.spectrumRenderer.renderAxis(spectrumData,editor.spectrumRenderer.box,'black');
			editor.spectrumRenderer.renderGrid(editor.specObject.mainSpecBox,'black',spectrumData.spectrum);

			
			document.staticGraphics = goog.graphics.createGraphics(1200,400);
			
			//Display the informations about the molecule
		    goog.dom.getElement("molName").innerHTML="<b>Molecule name: </b>"+spectrumData.molecule.name;
		    goog.dom.getElement("molId").innerHTML="<b>Molecule id: </b>"+spectrumData.molecule.molecule_id;
     		goog.dom.getElement("experimentType").innerHTML="<b>Experiment type: </b>"+spectrumData.experienceType;

			//Creation of the tool bar
		    var select1 = new goog.ui.Select();
		    select1.addItem(new goog.ui.MenuItem('NMR_0', 0));
		    select1.addItem(new goog.ui.MenuItem('NMR_1', 1));
		    select1.addItem(new goog.ui.MenuItem('NMR_2', 2));
		    select1.addItem(new goog.ui.MenuItem('NMR_3', 3));
		    select1.addItem(new goog.ui.MenuItem('NMR_4', 4));
		    select1.addItem(new goog.ui.MenuItem('NMR_5', 5));
		    select1.addItem(new goog.ui.MenuItem('NMR_6', 6));
		    select1.addItem(new goog.ui.MenuItem('NMR_7', 7));
		    select1.addItem(new goog.ui.MenuItem('NMR_8', 8));
		    select1.addItem(new goog.ui.MenuItem('NMR_9', 9));
		    select1.addItem(new goog.ui.MenuItem('NMR_10', 10));
		    select1.addItem(new goog.ui.MenuItem('NMR_11', 11));
		    select1.addItem(new goog.ui.MenuItem('NMR_12', 12));
		    select1.addItem(new goog.ui.MenuItem('MS_0 (very old cml file)', 13));
		    select1.addItem(new goog.ui.MenuItem('Narengenin)', 14));
		    select1.addItem(new goog.ui.MenuItem('chEBI:776', 15)); 
		    select1.addItem(new goog.ui.MenuItem('chEBI:1734', 16));
		    select1.addItem(new goog.ui.MenuItem('chEBI:1895 (problem in mol coords)', 17));
		    select1.addItem(new goog.ui.MenuItem('chEBI:2303', 18));
		    select1.addItem(new goog.ui.MenuItem('chEBI:776', 19));
		    select1.addItem(new goog.ui.MenuItem('16alpha-hydroxyestrone (SAIDs NTOBM)', 20));
		    select1.addItem(new goog.ui.MenuItem('4-O methylsoflavone (SAIDs NNTOM)', 21));
		    select1.addItem(new goog.ui.MenuItem('8-(1,1-dimethylallyl)galangin (SAIDs NTOBM)', 22));
		    select1.addItem(new goog.ui.MenuItem('(+)-absicissic acid (SAIDs NNTM)', 23));
		    select1.addItem(new goog.ui.MenuItem('amoxiciline (SAIDs NNTM)', 24));
		    select1.addItem(new goog.ui.MenuItem('8-(1,1-dimethylallyl)galangin (SAIDs NNTM)', 25));
		    select1.addItem(new goog.ui.MenuItem('benzatrapone (SAIDs NNTM)', 26));
		    select1.addItem(new goog.ui.MenuItem('betaxolone (SAIDs NNTM)', 27));
		    select1.addItem(new goog.ui.MenuItem('biperiden (SAIDs NNTM)', 28));
		    select1.addItem(new goog.ui.MenuItem('Bigass molecule (SAIDsc NNTM)', 29));
		    select1.addItem(new goog.ui.MenuItem('brinzolamide (SAIDsc NNTM)', 30));
		    select1.addItem(new goog.ui.MenuItem('MS/MS (SAIDsc NNTM)', 31));
		    select1.addItem(new goog.ui.MenuItem('Fake spectrum(test) ', 32));		     
		    
		    select1.setSelectedIndex(0);
		    select1.render(goog.dom.getElement('selectMolecule'));
		    
		
		    goog.events.listen(select1, goog.ui.Component.EventType.ACTION,
		    function(e) {
		    	zoom=0;
		      isGrid=false;
		      isAxis=false;
		      var select = e.target;
		      var idx = select.getValue();
		      if(cmlData[idx]==undefined){
		          alert("NO SUCH MOLECULE IN THE ARRAY! Default molecle will be displayed : ")
		          idx=0;
		      }
		      var molfile=cmlData[idx];
		      var xmlDox;
			      xmlDoc=specview.io.SpectrumCMLParser.getDocument(molfile);//XML document
			      spectrumData=new specview.model.NMRdata();
			      spectrumData=specview.io.SpectrumCMLParser.parseDocument(spectrumData,xmlDoc);//a cmlObject
				  spectrumData.setCoordinatesWithPixels(editor,0)
			//CAREFUL WITH THE FOLLOWING LINE
			  editor.setSpecObject(spectrumData);
		      editor.setModels([spectrumData]);
		      editor.spectrumRenderer.renderAxis(spectrumData,editor.spectrumRenderer.box,'black');
			  editor.spectrumRenderer.renderGrid(editor.specObject.mainSpecBox,'black',spectrumData.spectrum);
			  document.metaSpecObject = spectrumData;
			  goog.dom.getElement("molName").innerHTML="<b>Molecule name: </b>"+spectrumData.molecule.name;
			  goog.dom.getElement("molId").innerHTML="<b>Molecule id: </b>"+spectrumData.molecule.molecule_id;
			  goog.dom.getElement("experimentType").innerHTML="<b>Experiment type: </b>"+spectrumData.experienceType;
		      
		    });
		    
};
goog.events.listen(window, goog.events.EventType.LOAD, initPage);



//window.onscroll = function () {
//   var oTextbox = document.getElementById("txt1");
//  oTextbox.value += "\nscroll is at " + document.body.scrollLeft + " horizontally and " + document.body.scrollTop + " vertically.";
//}

function expandSpectrum(){
	spectrumData.expand = true;
	editor.expandSpectrum();
	editor.spectrumRenderer.clearSpectrum(spectrumData.mainSpecBox,editor.graphics)
	editor.spectrumRenderer.render(spectrumData,spectrumData.transform,spectrumData.mainSpecBox);
  editor.spectrumRenderer.renderAxis(spectrumData,editor.spectrumRenderer.box,'black');
	editor.spectrumRenderer.renderGrid(editor.specObject.mainSpecBox,'black',spectrumData.spectrum);	
}

document.showParentSpectrum = function (){

}


document.showChildSpectrum = function(){
	var showMolecule = document.getElementById("showChildMoleculeOption").checked;
	var showSpectrum = document.getElementById("showChildSpectrumOption").checked;
	if(showMolecule || showSpectrum){
		
		editor.showChild(showMolecule,showSpectrum);
	}
}

function resetSpectrum(){
	editor.clearSamy(spectrumData.spectrum, spectrumData.mainSpecBox,spectrumData.transform);
}

function resetMolecule(){
	editor.clearSamy(spectrumData.molecule,spectrumData.mainMolBox,spectrumData.transform);	
}
</script>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Display spectrum demo</title>
	<link rel="stylesheet" href="../../css/specview.css" />
	<link rel="stylesheet"  href="../../css/demo.css" />
	 <img name="logoMetabolight"  src="../../images/searchBox.png"
	 	  width="1400" height="100" alt="Zoom Tool"  title="Zoom Tool"/>
	 <img name="Metabolight"  src="../../images/banner.png"
 	 	  style="position:absolute;left:25px;top:35px;display:block;z-index:10;"/>
</head>




<body>

<script type="text/javascript" language="JavaScript">
var cX = 0; var cY = 0; var rX = 0; var rY = 0;

function UpdateCursorPosition(e){
	cX = e.pageX; cY = e.pageY;
}

function UpdateCursorPositionDocAll(e){
	cX = event.clientX; cY = event.clientY;
	}

if(document.all) { 
	document.onmousemove = UpdateCursorPositionDocAll; 
}else{
	document.onmousemove = UpdateCursorPosition; 
}

function AssignPosition(d) {
	if(self.pageYOffset) {
		rX = self.pageXOffset;
		rY = self.pageYOffset;
		}
	else if(document.documentElement && document.documentElement.scrollTop) {
		rX = document.documentElement.scrollLeft;
		rY = document.documentElement.scrollTop;
		}
	else if(document.body) {
		rX = document.body.scrollLeft;
		rY = document.body.scrollTop;
		}
	if(document.all) {
		cX += rX; 
		cY += rY;
		}
	d.style.left = (cX+10) + "px";
	d.style.top = (cY+10) + "px";
}

/*
* Hide the floating window
*/
document.HideContent = function(d) {
	if(d.length < 1) {
		return; 
	}
	document.getElementById(d).style.display = "none";
	specview.controller.plugins.Highlight.zoomObject=null;
};

/**
* Display a floating window
*/

document.ShowContent = function(d) {
	if(d.length < 1) {
		return; 
	}
	var dd = document.getElementById(d);
	AssignPosition(dd);
	dd.style.display = "block";
};

function ReverseContentDisplay(d) {
	if(d.length < 1) { return; }
	var dd = document.getElementById(d);
	AssignPosition(dd);
	if(dd.style.display == "none") { dd.style.display = "block"; }
	else { dd.style.display = "none"; }
}
//-->




</script>


<div 
 id="floatingBox" 
 style="display:none; 
    position:absolute; 
    border-style: double;
    background-color: #AAAAAA; 
    padding: 1px;">
    This peak is the<br> parent of a spectrum.<br><br>
<li>
Child spectrum :
</li>
	<ul>
		<li>
		Show molecule ?<input type="checkbox" id="showChildMoleculeOption" checked>
		</li>
		<li>
		Show spectrum ?<input type="checkbox" id="showChildSpectrumOption" checked>  
		</li>
		<li>
		<input type="button" onclick="document.showChildSpectrum()" value="Show child">
<!-- <a id="showChildSpectrum" href="javascript:showChildSpectrum" >Show child</a> -->		
		</li>
	</ul>
<li>
Parent spectrum :
</li>
	<ul>
		<li>
		Show molecule ?<input type="checkbox" id="showParentMoleculeOption" checked>
		</li>
		<li>
		Show spectrum ?<input type="checkbox" id="showParentSpectrumOption" checked>  
		</li>
		<li>
		<input type="button" onclick="document.showParentSpectrum()" value="Show parent">
<!-- <a id="showParentSpectrum" href="javascript:showParentSpectrum" >Show Parent</a> -->		
		</li>
	</ul>
<br>
<li>
<a 
 onmouseover="document.HideContent('floatingBox'); return true;"
 href="javascript:HideContent('floatingBox')">
Hide the window
</a>
</li>
</div>

<input class = "button" type = "button" name = "chk1" onclick = "newPage('./help.html')" value = "A little help?">
<input class = "button" type = "button" name = "chk1" onclick = "newPage('./color.html')" value = "Color picker?">
<input class = "button" type = "button" name = "chk1" onclick = "expandSpectrum()" value = "Expand spetrum?">
<input class = "button" type = "button" name = "chk1" onclick = "newPage('http://www.yourPopUppage.com')" value = "Unzoom? KO">
<input class = "button" type = "button" name = "chk1" onclick = "resetMolecule()" value = "Reset Molecule?">
<input class = "button" type = "button" name = "chk1" onclick = "resetSpectrum()" value = "Reset Spectrum?">
<input class = "button" type = "button" name = "chk1" onclick = "newPage('http://www.yourPopUppage.com')" value = "Move molecule? KO">
<script type = "text/javascript">
var count = 0;
function newPage(page) {
	if (count == 0) {  // once only
		count ++;
//		page = "file://localhost/home/epu/metabolomes/metabolomes/trunk/specview/src/main/javascript/specview/specview/controller/help.html"
		OpenWin = this.open(page,"CtrlWindow",
						 "top=80,left=100,screenX=100,screenY=80,width=550,height=460,toolbar=no,menubar=no,location=no, scrollbars=no,resizable=yes");
		}

function closepop() 
{
	if (OpenWin != null)
		OpenWin.close() 
	}
window.onunload = closepop;
count = 0;
}
</script>

	<fieldset id="fieldSet" style="width:1200px">
      <legendstyle="top:143px"><h1>MetaboLight Spectrum viewer</h1></legend>
      <br>
      <li id="molName"></li>
      <li id="molId"></li>
      <li id="experimentType"></li>
      <li id="experimentId"><b>Experiment id: </b><script>//document.write(spectrumData.molecule.name)</script></li>
   
   
   <div id="colorOption"
      style="top: 143px;
			   left: 470px;
  		   position: absolute;
		       z-index: 1;
  		   visibility: show;">
	<b>+Select your highlighting options</b><br><br>
	 -Atoms
   <select  id = "atomHighlightColor" size="1">
  	    <option>orange</option>
	        <option>blue</option>
      	<option>red</option>
      	<option>black</option>
      	<option>brown</option>
	</select><br>
	-Bonds
   <select  id = "bondHighlightColor" size="1">
  	    <option>orange</option>
	        <option>blue</option>
      	<option>red</option>
      	<option>black</option>
      	<option>brown</option>
	</select><br>
	-Peaks
   <select  id = "peakHighlightColor" size="1">
  	    <option>orange</option>
	        <option>blue</option>
      	<option>red</option>
      	<option>black</option>
      	<option>brown</option>
	</select>
	 </div>
	 
	   

	 

<script>
  var $ = goog.dom.getElement;
  var Z = 5;

  var limits = new goog.math.Rect(515,95,300,0)
  //To move the spectra and to adjust the zoom
  var sliderMoveSpectra=new goog.fx.Dragger($('slider4'),null,limits);
  var previousPercent=50;
  goog.events.listen(sliderMoveSpectra,'drag',function(e){
      var percent = Math.abs(Math.round(100 * (e.left - e.dragger.limits.left) /
	          e.dragger.limits.width)-100);
  })
  
  var limits2 = new goog.math.Rect(515,95,300,0)
  //To move the spectra and to adjust the zoom
  var sliderMoveSpectra=new goog.fx.Dragger($('slider4'),null,limits2);
  var previousPercent=50;
  goog.events.listen(sliderMoveSpectra,'drag',function(e){
      var percent = Math.abs(Math.round(100 * (e.left - e.dragger.limits.left) /
	          e.dragger.limits.width)-100);
  })
 
  function modifySensitivity(object,sign){
		switch(object){
		case "atom" :
			var max = document.atomSensitivity == 1;
			var min = document.atomSensitivity == 10;
			if(document.atomSensitivity > 1 && document.atomSensitivity < 10){
				sign=="+" ? document.atomSensitivity -= 1 : document.atomSensitivity += 1;
			}else if(max && sign=="-"){
				document.atomSensitivity += 1;
			}else if(min && sign=="+"){
				document.atomSensitivity -= 1;
			}else if(max && sign=="+"){
				alert("maximum sensitivity reached");
			}else if(min && sign=="-"){
				alert("minimum sensitivity reached")
			}
			break;
		case "bond" :
			var max = document.bondSensitivity == 1;
			var min = document.bondSensitivity == 10;
			if(document.bondSensitivity > 1 && document.bondSensitivity < 10){
				sign=="+" ? document.bondSensitivity -= 1 : document.bondSensitivity += 1;
			}else if(max && sign=="-"){
				document.bondSensitivity += 1;
			}else if(min && sign=="+"){
				document.bondSensitivity -= 1;
			}else if(max && sign=="+"){
				alert("maximum sensitivity reached");
			}else if(min && sign=="-"){
				alert("minimum sensitivity reached")
			}
			break;
		case "peak" :
			var max = document.peakSensitivity == 1;
			var min = document.peakSensitivity == 10;
			if(document.peakSensitivity > 1 && document.peakSensitivity < 10){
				sign=="+" ? document.peakSensitivity -= 1 : document.peakSensitivity += 1;
			}else if(max && sign=="-"){
				document.peakSensitivity += 1;
			}else if(min && sign=="+"){
				document.peakSensitivity -= 1;
			}else if(max && sign=="+"){
				alert("maximum sensitivity reached");
			}else if(min && sign=="-"){
				alert("minimum sensitivity reached")
			}
			break;
		default :
			break;
		}
  }

//  function modifySensitivit(object,sign){
///   	alert(object+" ; "+sign+"  ;   "+document.atomSensitivity)
//  }
  
</script>


<div	style="top: 143px;
			   left: 740px;
  		   position: absolute;
		       z-index: 1;
  		   visibility: show;">
	<b>+Select your sensitivity</b><br><br>
	-Atoms  <input class="smallButton" type="button" id="atomSensitivity" value="-" onclick="modifySensitivity('atom','-')">
			<input class="smallButton" type="button" id="atomSensitivity" value="+" onclick="modifySensitivity('atom','+')"><br>
			
	-Bonds  <input class="smallButton" type="button" id="bondSensitivity" value="-" onclick="modifySensitivity('bond','-')">
			<input class="smallButton" type="button" id="atomSensitivity" value="+" onclick="modifySensitivity('bond','+')"><br>
			
	-Peaks  <input class="smallButton" type="button" id="peakSensitivity" value="-" onclick="modifySensitivity('peak','-')">
			<input class="smallButton" type="button" id="atomSensitivity" value="+" onclick="modifySensitivity('peak','+')">
</div>
	 <div id="opacityOption"
      style="top: 143px;
			   left: 920px;
  		   position: absolute;
		       z-index: 1;
  		   visibility: show;">
   +<b>Select your opacity preference</b><br><br>
   -Atoms<br>     
   -Bonds<br> 
   -Peaks<br>
   </div>
   
   <div id="sliderAtomOpacity"><script>document.write("<->")</script></div>	
   <div id="sliderBondOpacity"><script>document.write("<->")</script></div>
   <div id="sliderPeakopacity"><script>document.write("<->")</script></div>
   
      <label id="selectMolecule">Select a spectrum to render: </label>
      <br>
      <div id="moleculeContainer" style="height:800px"></div>
	</fieldset>


</body>
</html>


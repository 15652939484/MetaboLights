<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>

<script src="../../third-party/closure/closure/goog/base.js"></script>
<script src="../deps.js"></script>
<script src="../../specviewTest/data/cmlfile.js"></script>
<script>
    goog.require('goog.events.EventType');
    goog.require('goog.ui.Select');
    goog.require('specview.controller.Controller');
    goog.require('specview.controller.plugins.Highlight');
    goog.require('specview.controller.plugins.Zoom');
 //   goog.require('specview.controller.DefaultToolbar');
 //   goog.require('specview.controller.ToolbarController');
// 	goog.require('specview.controller.plugins.BondEdit');
    goog.require('specview.io.SpectrumCMLParser');
    goog.require('specview.model.NMRdata');
    goog.require('goog.events.MouseWheelHandler');
    goog.require('goog.fx.Dragger');
    goog.require('goog.dom');
    goog.require('goog.math');
    goog.require('goog.ui.DragDropDetector');
    goog.require('goog.style');
    goog.require('goog.graphics');
</script>

<script>

//editor=null;
spectrumData=null;
zoom=0;

function initPage(){
			var isGrid=false;
			var isAxis=false;
			// uncomment next two lines to debug to console						
			var c = new goog.debug.Console(); 
			c.setCapturing(true); 
			
			
//			var toolbar = new specview.controller.DefaultToolbar.makeDefaultMoleculeToolbar(goog.dom.getElement('moleculeEditorToolbar'));  
			
			var cmlData=cmlmolecules.split("$$END$$\n");
			var xmlDoc=specview.io.SpectrumCMLParser.getDocument(cmlData[1]);//XML document
			spectrumData=new specview.model.NMRdata();
			spectrumData=specview.io.SpectrumCMLParser.parseDocument(spectrumData,xmlDoc,navigator.appName);//a cmlObject
			
			//Create the canvas and provide it with highlight plugins
			editor = new specview.controller.Controller(goog.dom.getElement('moleculeContainer'),{background : {color : 'white'}});
			editor.registerPlugin(new specview.controller.plugins.Highlight());
			editor.registerPlugin(new specview.controller.plugins.Zoom());
//			editor.registerPlugin(new specview.controller.plugins.BondEdit());
			spectrumData.editor=editor;

			spectrumData.setCoordinatesWithPixels(editor)

			editor.setSpecObject(spectrumData);
			editor.setModels([spectrumData],false);
			editor.spectrumRenderer.renderAxis(spectrumData,editor.spectrumRenderer.box,'black');
			editor.spectrumRenderer.renderGrid(editor.specObject.mainSpecBox,'black',spectrumData.spectrum);

			
			document.metaSpecObject = spectrumData;
			
			//Display the informations about the molecule
		    goog.dom.getElement("molName").innerHTML="<b>Molecule name: </b>"+spectrumData.molecule.name;
		    goog.dom.getElement("molId").innerHTML="<b>Molecule id: </b>"+spectrumData.molecule.molecule_id;
     		goog.dom.getElement("experimentType").innerHTML="<b>Experiment type: </b>"+spectrumData.experienceType;

			//Creation of the tool bar
		    var select1 = new goog.ui.Select();
		    select1.addItem(new goog.ui.MenuItem('NMR_0', 0));
		    select1.addItem(new goog.ui.MenuItem('NMR_1', 1));
		    select1.addItem(new goog.ui.MenuItem('NMR_2', 2));
		    select1.addItem(new goog.ui.MenuItem('NMR_3', 3));
		    select1.addItem(new goog.ui.MenuItem('NMR_4', 4));
		    select1.addItem(new goog.ui.MenuItem('NMR_5', 5));
		    select1.addItem(new goog.ui.MenuItem('NMR_6', 6));
		    select1.addItem(new goog.ui.MenuItem('NMR_7', 7));
		    select1.addItem(new goog.ui.MenuItem('NMR_8', 8));
		    select1.addItem(new goog.ui.MenuItem('NMR_9', 9));
		    select1.addItem(new goog.ui.MenuItem('NMR_10', 10));
		    select1.addItem(new goog.ui.MenuItem('NMR_11', 11));
		    select1.addItem(new goog.ui.MenuItem('NMR_12', 12));
		    select1.addItem(new goog.ui.MenuItem('MS_0', 13));
		    select1.addItem(new goog.ui.MenuItem('MS_1', 14));
		    select1.addItem(new goog.ui.MenuItem('MS_2', 15)); 
		    select1.addItem(new goog.ui.MenuItem('MS_3', 16));
		    select1.addItem(new goog.ui.MenuItem('MS_4', 17));
		    select1.addItem(new goog.ui.MenuItem('MS_5', 18));
		    select1.addItem(new goog.ui.MenuItem('MS_6', 19));
		    
		    select1.setSelectedIndex(0);
		    select1.render(goog.dom.getElement('selectMolecule'));
		    
		    var grid= new goog.ui.Button("grid");
		    grid.render(goog.dom.getElement('selectMolecule'));
		    var axis= new goog.ui.Button("axis");
		    axis.render(goog.dom.getElement('selectMolecule'));
		    var resetSpectrum = new goog.ui.Button('resetSpectrum');
		    resetSpectrum.render(goog.dom.getElement('resetSpectrum'));
		    var resetMolecule = new goog.ui.Button('resetMolecule');
		    resetMolecule.render(goog.dom.getElement('resetMolecule'));
			var resetTextExperiment = new goog.ui.Button('resetTextExperiment');
			resetTextExperiment.render(goog.dom.getElement('resetTextExperiment'));
			var unzoom = new goog.ui.Button("unzoom");
			unzoom.render(goog.dom.getElement('unzoom'));
			
			
			
			goog.events.listen(resetTextExperiment,goog.ui.Component.EventType.ACTION,
					function(e){
		    	for(var k = 0;k<15 ; k++){
					editor.clearSamy(spectrumData.metadata,spectrumData.mainSpecBox);
		    	}
			});
  
		    
		    goog.events.listen(resetMolecule,goog.ui.Component.EventType.ACTION,
		    		function(e){
		    		editor.clearSamy(spectrumData.molecule,spectrumData.mainMolBox,spectrumData.transform);	
		    });
			/*
			 Rudimentary way of specificaly clearing the spectrum
			*/
		    goog.events.listen(resetSpectrum,goog.ui.Component.EventType.ACTION,
		    		function(e){
			    	editor.clearSamy(spectrumData.spectrum, spectrumData.mainSpecBox,spectrumData.transform);
		    });
		    
		    goog.events.listen(axis,goog.ui.Component.EventType.ACTION,
		    		function(e){
		    	if(!isAxis){
		    		editor.spectrumRenderer.renderAxis(spectrumData,editor.spectrumRenderer.box,'black');
		    		isAxis=true;
		    	}	
		    })
		    
		    goog.events.listen(grid, goog.ui.Component.EventType.ACTION,
		    		function(e){
		    	if(!isGrid){
		    		editor.spectrumRenderer.renderGrid(editor.specObject.mainSpecBox,'black',spectrumData.spectrum);
		    		isGrid=true;
		    	}
		    })
		    
		    goog.events.listen(select1, goog.ui.Component.EventType.ACTION,
		    function(e) {
		    	zoom=0;
		      isGrid=false;
		      isAxis=false;
		      var select = e.target;
		      var idx = select.getValue();
		      if(cmlData[idx]==undefined){
		          alert("NO SUCH MOLECULE IN THE ARRAY! Default molecle will be displayed : ")
		          idx=0;
		      }
		      var molfile=cmlData[idx];
		      var xmlDox;
			      xmlDoc=specview.io.SpectrumCMLParser.getDocument(molfile);//XML document
			      spectrumData=new specview.model.NMRdata();
			      spectrumData=specview.io.SpectrumCMLParser.parseDocument(spectrumData,xmlDoc);//a cmlObject
				  spectrumData.setCoordinatesWithPixels(editor,0)
			//CAREFUL WITH THE FOLLOWING LINE
			  editor.setSpecObject(spectrumData);
		      editor.setModels([spectrumData]);
		      editor.spectrumRenderer.renderAxis(spectrumData,editor.spectrumRenderer.box,'black');
			  editor.spectrumRenderer.renderGrid(editor.specObject.mainSpecBox,'black',spectrumData.spectrum);
			  document.metaSpecObject = spectrumData;
			  goog.dom.getElement("molName").innerHTML="<b>Molecule name: </b>"+spectrumData.molecule.name;
			  goog.dom.getElement("molId").innerHTML="<b>Molecule id: </b>"+spectrumData.molecule.molecule_id;
			  goog.dom.getElement("experimentType").innerHTML="<b>Experiment type: </b>"+spectrumData.experienceType;
		      
		    });

};
goog.events.listen(window, goog.events.EventType.LOAD, initPage);



//window.onscroll = function () {
 //   var oTextbox = document.getElementById("txt1");
  //  oTextbox.value += "\nscroll is at " + document.body.scrollLeft + " horizontally and " + document.body.scrollTop + " vertically.";
//}


</script>

<head>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>Display spectrum demo</title>
	<link rel="stylesheet" href="../../css/specview.css" />
	<link rel="stylesheet"  href="../../css/demo.css" />
	 <img name="logoMetabolight"  src="../../images/searchBox.png"
	 	  width="1400" height="100" alt="Zoom Tool"  title="Zoom Tool"/>
	 <img name="Metabolight"  src="../../images/banner.png"
   	 	  style="position:absolute;left:25px;top:35px;display:block;z-index:10;"/>
</head>




<body>

	<fieldset style="width:1200px">
        <legendstyle="top:143px"><h1>MetaboLight Spectrum viewer</h1></legend>
        <br>
        <li id="molName"></li>
        <li id="molId"></li>
        <li id="experimentType"></li>
        <li id="experimentId"><b>Experiment id: </b><script>//document.write(spectrumData.molecule.name)</script></li>
     
     
     <div
        style="top: 143px;
			   left: 470px;
    		   position: absolute;
		       z-index: 1;
    		   visibility: show;">
	 <b>Visualisation of experiment of type</b>:
	 	<br><br>-H NMR
	 	<br>-C NMR
	 	<br>-Mass Spec     
	 </div>

        <li id=zoom
        	style="position:absolute;left:780px;top:143px"><b>Zoom</b>: To zoom on the spectrum, drag a rectangle<br> over the area you wish to focus on.</li>
        	
        <li id=focalisation
        	style="position:absolute;left:780px;top:193px"><b>Localisation</b>:When you zoom on the spectrum, the<br> spectrum on the boottom right corner help you localise<br> where you are</li>
        	
        <label id="selectMolecule">Select a spectrum to render: </label>
        <br>
        <div id="moleculeContainer" style="height:500px"></div>
	</fieldset>


</body>
</html>


metExploreD3.GraphMapping={mapNodeData:function(c,b){var e=_metExploreViz.getSessionById("viz");var d=e.getForce();d.stop();var a=metExploreD3.createLoadMask("Mapping in progress...","viz");if(a!=undefined){metExploreD3.showMask(a);setTimeout(function(){var l=e.getD3Data();var m=c.getConditions();var f=d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node");var h=undefined;switch(c.getTargetLabel()){case"reactionDBIdentifier":for(var g=m.length-1;g>=0;g--){b.forEach(function(i){var o=new MappingData(i[0],c.getName(),m[g],i[g+1]);c.addMap(o);h=l.getNodeByDbIdentifier(i[0]);if(h!=undefined){var n=new MappingData(h,c.getName(),m[g],i[g+1]);h.addMappingData(n)}})}break;case"reactionId":for(var g=m.length-1;g>=0;g--){b.forEach(function(i){var o=new MappingData(i[0],c.getName(),m[g],i[g+1]);c.addMap(o);h=l.getNodeById(i[0]);if(h!=undefined){var n=new MappingData(h,c.getName(),m[g],i[g+1]);h.addMappingData(n)}})}break;case"metaboliteId":for(var g=m.length-1;g>=0;g--){b.forEach(function(i){var o=new MappingData(i[0],c.getName(),m[g],i[g+1]);c.addMap(o);h=l.getNodeById(i[0]);if(h!=undefined){var n=new MappingData(h,c.getName(),m[g],i[g+1]);h.addMappingData(n)}})}break;case"metaboliteDBIdentifier":for(var g=m.length-1;g>=0;g--){b.forEach(function(i){var o=new MappingData(i[0],c.getName(),m[g],i[g+1]);c.addMap(o);h=l.getNodeByDbIdentifier(i[0]);if(h!=undefined){var n=new MappingData(h,c.getName(),m[g],i[g+1]);h.addMappingData(n)}})}break;case"inchi":break;default:metExploreD3.displayMessage("Warning",'The type of node "'+c.getTargetLabel()+"\" isn't know.")}metExploreD3.hideMask(a);var k=metExploreD3.GraphNetwork.isAnimated("viz");if(k=="true"){var j=e.getForce();if((d3.select("#viz").select("#D3viz").attr("animation")=="true")||(d3.select("#viz").select("#D3viz").attr("animation")==null)){j.resume()}}},1000)}},mapNodes:function(a){metExploreD3.onloadMapping(a,function(){d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(e){if(this.getAttribute("mapped")==undefined||this.getAttribute("mapped")==false||this.getAttribute("mapped")=="false"){return false}else{return true}}).attr("mapped","false").selectAll("rect.stroke").remove();var b=metExploreD3.createLoadMask("Mapping in progress...","viz");var c=_metExploreViz.getMappingByName(a);if(b!=undefined){metExploreD3.showMask(b);setTimeout(function(){var g=_metExploreViz.getSessionById("viz");var e=g.getForce();e.stop();var f=c.getConditions();f.forEach(function(h){d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("g.node").filter(function(i){if(this.getAttribute("mapped")==undefined||this.getAttribute("mapped")==false||this.getAttribute("mapped")=="false"){return true}else{return false}}).each(function(k){if(k.getBiologicalType()=="reaction"){if(k.getMappingDataByNameAndCond(c.getName(),h)!=null){var i=metExploreD3.getReactionStyle();_MyThisGraphNode.addText(k,"viz",i);d3.select(this).attr("mapped","true").insert("rect",":first-child").attr("class","stroke").attr("width",parseInt(d3.select(this).select(".reaction").attr("width"))+10).attr("height",parseInt(d3.select(this).select(".reaction").attr("height"))+10).attr("rx",parseInt(d3.select(this).select(".reaction").attr("rx"))+5).attr("ry",parseInt(d3.select(this).select(".reaction").attr("ry"))+5).attr("transform","translate(-"+parseInt(parseInt(d3.select(this).select(".reaction").attr("width"))+10)/2+",-"+parseInt(parseInt(d3.select(this).select(".reaction").attr("height"))+10)/2+")").style("opacity","0.5").style("fill","red");g.addSelectedNode(k.getId())}}else{if(k.getBiologicalType()=="metabolite"){var l=d3.select(this).select(".metabolite").attr("identifier");if(k.getMappingDataByNameAndCond(c.getName(),h)!=null){var j=metExploreD3.getReactionStyle();_MyThisGraphNode.addText(k,"viz",j);d3.select(this).attr("mapped","true").insert("rect",":first-child").attr("class","stroke").attr("width",parseInt(d3.select(this).select(".metabolite").attr("width"))+10).attr("height",parseInt(d3.select(this).select(".metabolite").attr("height"))+10).attr("rx",parseInt(d3.select(this).select(".metabolite").attr("rx"))+5).attr("ry",parseInt(d3.select(this).select(".metabolite").attr("ry"))+5).attr("transform","translate(-"+parseInt(parseInt(d3.select(this).select(".metabolite").attr("width"))+10)/2+",-"+parseInt(parseInt(d3.select(this).select(".metabolite").attr("height"))+10)/2+")").style("opacity","0.5").style("fill","red");g.addSelectedNode(k.getId())}}}}).each(function(k){if(d3.select(this).select(".stroke")[0][0]==null){if(k.getBiologicalType()=="reaction"){if(k.getMappingDataByNameAndCond(c.getName(),h)!=null){var i=metExploreD3.getReactionStyle();_MyThisGraphNode.addText(k,"viz",i);d3.select(this).insert("rect",":first-child").attr("class","stroke").attr("width",parseInt(d3.select(this).select(".reaction").attr("width"))+10).attr("height",parseInt(d3.select(this).select(".reaction").attr("height"))+10).attr("rx",parseInt(d3.select(this).select(".reaction").attr("rx"))+5).attr("ry",parseInt(d3.select(this).select(".reaction").attr("ry"))+5).attr("transform","translate(-"+parseInt(parseInt(d3.select(this).select(".reaction").attr("width"))+10)/2+",-"+parseInt(parseInt(d3.select(this).select(".reaction").attr("height"))+10)/2+")").style("opacity","0.5").style("fill","red");g.addSelectedNode(k.getId());return true}else{return false}}else{if(k.getBiologicalType()=="metabolite"){var l=d3.select(this).select(".metabolite").attr("identifier");if(k.getMappingDataByNameAndCond(c.getName(),h)!=null){var j=metExploreD3.getReactionStyle();_MyThisGraphNode.addText(k,"viz",j);d3.select(this).insert("rect",":first-child").attr("class","stroke").attr("width",parseInt(d3.select(this).select(".metabolite").attr("width"))+10).attr("height",parseInt(d3.select(this).select(".metabolite").attr("height"))+10).attr("rx",parseInt(d3.select(this).select(".metabolite").attr("rx"))+5).attr("ry",parseInt(d3.select(this).select(".metabolite").attr("ry"))+5).attr("transform","translate(-"+parseInt(parseInt(d3.select(this).select(".metabolite").attr("width"))+10)/2+",-"+parseInt(parseInt(d3.select(this).select(".metabolite").attr("height"))+10)/2+")").style("opacity","0.5").style("fill","red");g.addSelectedNode(k.getId());return true}else{return false}}}}})});metExploreD3.hideMask(b);var d=metExploreD3.GraphNetwork.isAnimated("viz");if(d=="true"){var g=_metExploreViz.getSessionById("viz");var e=g.getForce();if((d3.select("#viz").select("#D3viz").attr("animation")=="true")||(d3.select("#viz").select("#D3viz").attr("animation")==null)){e.resume()}}},1000)}})},reloadMapping:function(b){var d=_metExploreViz.getSessionById("viz");var c=d.getForce();c.stop();var a=metExploreD3.createLoadMask("Mapping in progress...","viz");if(a!=undefined){metExploreD3.showMask(a);setTimeout(function(){var h=d.getD3Data();var i=b.getConditions();var e=undefined;switch(b.getTargetLabel()){case"reactionDBIdentifier":b.getData().forEach(function(l){var j=h.getNodeByDbIdentifier(l.getNode());if(j!=undefined){var k=new MappingData(j,b.getName(),l.getConditionName(),l.getMapValue());j.addMappingData(k)}});break;case"reactionId":b.getData().forEach(function(l){var j=h.getNodeById(l.getNode());if(j!=undefined){var k=new MappingData(j,b.getName(),l.getConditionName(),l.getMapValue());j.addMappingData(k)}});break;case"metaboliteId":b.getData().forEach(function(l){var j=h.getNodeById(l.getNode());if(j!=undefined){var k=new MappingData(j,b.getName(),l.getConditionName(),l.getMapValue());j.addMappingData(k)}});break;case"metaboliteDBIdentifier":b.getData().forEach(function(l){var j=h.getNodeByDbIdentifier(l.getNode());if(j!=undefined){var k=new MappingData(j,b.getName(),l.getConditionName(),l.getMapValue());j.addMappingData(k)}});break;case"inchi":break;default:metExploreD3.displayMessage("Warning",'The type of node "'+b.getTargetLabel()+"\" isn't know.")}metExploreD3.hideMask(a);var g=metExploreD3.GraphNetwork.isAnimated("viz");if(g=="true"){var f=d.getForce();if((d3.select("#viz").select("#D3viz").attr("animation")=="true")||(d3.select("#viz").select("#D3viz").attr("animation")==null)){f.resume()}}},1000)}},graphMappingDiscreteData:function(b,a){metExploreD3.onloadMapping(b,function(){var d=_metExploreViz.getMappingByName(b);var c=metExploreD3.createLoadMask("Mapping in progress...","viz");if(c!=undefined){metExploreD3.showMask(c);setTimeout(function(){var r=_metExploreViz.getSessionById("viz");var h=r.getForce();h.stop();var s=d.getConditions();var g=r.getD3Data().getNodes();var v=[];var j=d3.select("#viz").select("#D3viz");j.selectAll("g.node").filter(function(i){if(this.getAttribute("mapped")==undefined||this.getAttribute("mapped")==false||this.getAttribute("mapped")=="false"){return false}else{return true}}).selectAll("rect.stroke").remove();s.forEach(function(i){g.forEach(function(y){var z=y.getMappingDataByNameAndCond(d.getName(),i);if(z!=null){var x=false;var w=z.getMapValue().valueOf();v.forEach(function(A){if(A.valueOf()==w.valueOf()){x=true}});if(!x){v.push(w)}}})});function e(w,i){if(parseFloat(w)<parseFloat(i)){return -1}if(parseFloat(w)>parseFloat(i)){return 1}return 0}function p(w,i){if(w<i){return -1}if(w>i){return 1}return 0}var q=[];var u=[];v.forEach(function(i){if(isNaN(i)){u.push(i)}else{q.push(i)}});q.sort(e);u.sort(p);v=q.concat(u);if(v.length==undefined){v.length=0}center=128;width=127;frequency=Math.PI*2*0.95/v.length;var o=top;var f=r.getColorMappingsSet();r.resetColorMapping();for(var n=0;n<v.length;n++){var k=Math.sin(frequency*n+2+v.length)*width+center;var m=Math.sin(frequency*n+0+v.length)*width+center;var t=Math.sin(frequency*n+4+v.length)*width+center;color=metExploreD3.GraphUtils.RGB2Color(k,m,t);r.addColorMapping(v[n],color);metExploreD3.GraphMapping.fixMappingColorOnNodeData(color,v[n],a,d.getName())}metExploreD3.hideMask(c);if(v.length!=0){metExploreD3.fireEventArg("selectConditionForm","afterDiscreteMapping","discrete")}else{metExploreD3.displayMessage("Warning","No mapped node on network.")}var l=metExploreD3.GraphNetwork.isAnimated("viz");if(l=="true"){var r=_metExploreViz.getSessionById("viz");var h=r.getForce();if((d3.select("#viz").select("#D3viz").attr("animation")=="true")||(d3.select("#viz").select("#D3viz").attr("animation")==null)){h.resume()}}},1000)}})},fixMappingColorOnNodeData:function(a,e,c,f){var d=d3.select("#viz").select("#D3viz");var b=a;d.selectAll("g.node").filter(function(j){if(j.getBiologicalType()=="reaction"){if(j.getMappingDatasLength()==0){return false}else{var i=j.getMappingDataByNameAndCond(f,c);if(i!=null){if(i.getMapValue()==e){var g=metExploreD3.getReactionStyle();_MyThisGraphNode.addText(j,"viz",g);return true}else{return false}}else{return false}}}else{if(j.getBiologicalType()=="metabolite"){if(j.getMappingDatasLength()==0){return false}else{var i=j.getMappingDataByNameAndCond(f,c);if(i!=null){if(i.getMapValue()==e){var h=metExploreD3.getMetaboliteStyle();_MyThisGraphNode.addText(j,"viz",h);return true}else{return false}}else{return false}}}}}).transition().duration(3000).attr("mapped",a).style("fill",a).each(function(h){if(h.getBiologicalType()=="reaction"){var g=metExploreD3.GraphUtils.chooseTextColor(b);d3.select(this).select("text").style("fill",g)}})},graphMappingContinuousData:function(c,a,d,b){metExploreD3.onloadMapping(c,function(){var f=_metExploreViz.getMappingByName(c);var e=metExploreD3.createLoadMask("Mapping in progress...","viz");if(e!=undefined){metExploreD3.showMask(e);setTimeout(function(){var p=_metExploreViz.getGeneralStyle();var j=d3.select("#viz").select("#D3viz");var o=_metExploreViz.getSessionById("viz");var h=_metExploreViz.getSessionById("viz").getD3Data().getNodes();var q=f.getConditions();var m=undefined;var r=undefined;var s=f.getName();var n='{"mapping":[';j.selectAll("g.node").filter(function(t){if(this.getAttribute("mapped")==undefined||this.getAttribute("mapped")==false||this.getAttribute("mapped")=="false"){return false}else{return true}}).selectAll("rect.stroke").remove();q.forEach(function(t){n+='\n{"'+t+'":[';h.forEach(function(v){var w=v.getMappingDataByNameAndCond(s,t);if(w!=null){n+="\n{";var u=w.getMapValue();n+='"node" : "'+v.getName();n+='", "value" : "'+u;if(!isNaN(u)){if(m==undefined){r=parseFloat(u);m=parseFloat(u)}else{if(r>parseFloat(u)){r=parseFloat(u)}if(m<parseFloat(u)){m=parseFloat(u)}}}n+='"},\n'}});n+="]}\n"});n+="]}\n";if(d==undefined){d=p.getColorMinMappingContinuous()}if(b==undefined){b=p.getColorMaxMappingContinuous()}var j=d3.select("#viz").select("#D3viz");var g=o.getColorMappingsSet();o.resetColorMapping();var l=d3.scale.linear().domain([parseFloat(r),parseFloat(m)]).range([d,b]);if(r==m){o.addColorMapping(m,l(parseFloat(m)))}else{o.addColorMapping(m,l(parseFloat(m)));o.addColorMapping(r,l(parseFloat(r)))}j.selectAll("g.node").each(function(x){if(x.getMappingDatasLength()!=0){if(x.getBiologicalType()=="reaction"){var w=x.getMappingDataByNameAndCond(s,a);if(w!=null){if(!isNaN(w.getMapValue())){var u=metExploreD3.getReactionStyle();_MyThisGraphNode.addText(x,"viz",u);d3.select(this).transition().duration(2000).attr("mapped",l(parseFloat(parseFloat(w.getMapValue())))).style("fill",l(parseFloat(w.getMapValue())));var t=metExploreD3.GraphUtils.chooseTextColor(l(parseFloat(w.getMapValue())));d3.select(this).select("text").style("fill",t)}}}else{var w=x.getMappingDataByNameAndCond(s,a);if(w!=null){if(!isNaN(w.getMapValue())){var v=metExploreD3.getMetaboliteStyle();_MyThisGraphNode.addText(x,"viz",v);d3.select(this).transition().duration(2000).attr("mapped",l(parseFloat(parseFloat(w.getMapValue())))).style("fill",l(parseFloat(w.getMapValue())))}}}}});metExploreD3.hideMask(e);if(r!=undefined){metExploreD3.fireEventArg("selectConditionForm","afterContinuousMapping","continuous")}else{metExploreD3.displayMessage("Warning","No mapped node on network.")}var k=metExploreD3.GraphNetwork.isAnimated("viz");if(k=="true"){var o=_metExploreViz.getSessionById("viz");var i=o.getForce();if((d3.select("#viz").select("#D3viz").attr("animation")=="true")||(d3.select("#viz").select("#D3viz").attr("animation")==null)){i.resume()}}},1000)}})},graphMappingBinary:function(b){var c=metExploreD3.getSessionsSet();var e=metExploreD3.getSessionById(c,"viz");var d=e.getForce();d.stop();var a=metExploreD3.createLoadMask("Mapping in progress...","viz");if(a!=undefined){metExploreD3.showMask(a);setTimeout(function(){metExploreD3.GraphMapping.fixMappingColorOnNode("#056da1",1,b);metExploreD3.hideMask(a);var h=metExploreD3.GraphNetwork.isAnimated("viz");if(h=="true"){var f=metExploreD3.getSessionsSet();var i=metExploreD3.getSessionById(f,"viz");var g=i.getForce();if((d3.select("#viz").select("#D3viz").attr("animation")=="true")||(d3.select("#viz").select("#D3viz").attr("animation")==null)){g.resume()}}},1000)}},fixMappingColorOnNode:function(b,e,c){var d=d3.select("#viz").select("#D3viz");var f=metExploreD3.getMetabolitesSet();var a=metExploreD3.getReactionsSet();d.selectAll("g.node").filter(function(i){if(i.getBiologicalType()=="reaction"){if(metExploreD3.getReactionById(a,i.getId()).get("mapped")==undefined){return false}else{if((metExploreD3.getReactionById(a,i.getId()).get("mapped")!=0)&&metExploreD3.getReactionById(a,i.getId()).get(c)==e){var j=metExploreD3.getSessionsSet();var g=metExploreD3.getReactionStyle();_MyThisGraphNode.addText(i,"viz",g,j);return true}else{return false}}}else{if(i.getBiologicalType()=="metabolite"&&!i.isSideCompound()){if(metExploreD3.getMetaboliteById(f,i.getId())==null){return false}if(metExploreD3.getMetaboliteById(f,i.getId()).get("mapped")==undefined){return false}else{if((metExploreD3.getMetaboliteById(f,i.getId()).get("mapped")!=0)&&metExploreD3.getMetaboliteById(f,i.getId()).get(c)==e){var j=metExploreD3.getSessionsSet();var h=metExploreD3.getMetaboliteStyle();_MyThisGraphNode.addText(i,"viz",h,j);return true}else{return false}}}}}).transition().duration(4000).attr("mapped",b).style("fill",b)},setDiscreteMappingColor:function(b,e,c,g){var f=_metExploreViz.getSessionById("viz");var d=f.getForce();d.stop();var a=metExploreD3.createLoadMask("Mapping in progress...","viz");if(a!=undefined){metExploreD3.showMask(a);setTimeout(function(){var i=d3.select("#viz").select("#D3viz");var j=f.getColorMappingsSet();var h=f.getColorMappingById(e);h.setValue(b);metExploreD3.GraphMapping.fixMappingColorOnNodeData(b,e,c,g);metExploreD3.hideMask(a)},1000)}},setContinuousMappingColor:function(f,i,j,e){var h=_metExploreViz.getSessionById("viz");var b=h.getForce();b.stop();var d=metExploreD3.createLoadMask("Mapping in progress...","viz");if(d!=undefined){metExploreD3.showMask(d);var c=d3.select("#viz").select("#D3viz");var a=h.getColorMappingsSet();var g=h.getColorMappingById(i);g.setValue(f);metExploreD3.hideMask(d)}},removeGraphMapping:function(b){var e=_metExploreViz.getSessionById("viz");var c=d3.select("#viz").select("#D3viz");var d=metExploreD3.getMetabolitesSet();var a=metExploreD3.getReactionsSet();c.selectAll("g.node").filter(function(f){if(f.getBiologicalType()=="reaction"){if(metExploreD3.getReactionById(a,f.getId()).get("mapped")==undefined){return false}else{return metExploreD3.getReactionById(a,f.getId()).get("mapped")!=0}}else{if(f.getBiologicalType()=="metabolite"){if(metExploreD3.getMetaboliteById(d,f.getId()).get("mapped")==undefined){return false}else{return metExploreD3.getMetaboliteById(d,f.getId()).get("mapped")!=0}}}}).transition().duration(4000).style("fill","white");c.selectAll("g.node").filter(function(f){if(this.getAttribute("mapped")==undefined||this.getAttribute("mapped")==false||this.getAttribute("mapped")=="false"){return false}else{return true}}).attr("mapped","false").selectAll("rect.stroke").remove()},removeGraphMappingData:function(a){var c=_metExploreViz.getSessionById("viz");var b=d3.select("#viz").select("#D3viz");b.selectAll("g.node").transition().duration(4000).style("fill","white").each(function(d){if(d.getBiologicalType()=="reaction"){if(d.isSelected()){d3.select(this).select("text").transition().duration(4000).style("fill","white")}else{d3.select(this).select("text").transition().duration(4000).style("fill","black")}}});b.selectAll("g.node").filter(function(e){if(this.getAttribute("mapped")==undefined||this.getAttribute("mapped")==false||this.getAttribute("mapped")=="false"){return false}else{return true}}).attr("mapped","false").selectAll("rect.stroke").remove()},loadDataFromJSON:function(b){var d=_metExploreViz.getSessionById("viz");var c=d.getForce();c.stop();var a=metExploreD3.createLoadMask("Mapping in progress...","viz");if(a!=undefined){metExploreD3.showMask(a);setTimeout(function(){var g=Ext.decode(b);var f=[];g.mappings.forEach(function(j){f.push(j.name)});var e=new Mapping(g.name,f,g.targetLabel);_metExploreViz.addMapping(e);metExploreD3.GraphMapping.generateMapping(e,g.mappings);metExploreD3.hideMask(a);metExploreD3.fireEventArg("selectMappingVisu","jsonmapping",e);var i=metExploreD3.GraphNetwork.isAnimated("viz");if(i=="true"){var h=d.getForce();if((d3.select("#viz").select("#D3viz").attr("animation")=="true")||(d3.select("#viz").select("#D3viz").attr("animation")==null)){h.resume()}}},1000)}},generateMapping:function(a,b){var d=_metExploreViz.getSessionById("viz");var c=d.getD3Data();switch(a.getTargetLabel()){case"reactionDBIdentifier":if(!(b.length==1&&b[0].name=="undefined")){b.forEach(function(e){e.data.forEach(function(h){var i=new MappingData(h.node,a.getName(),e.name,h.value);a.addMap(i);var f=c.getNodeByDbIdentifier(h.node);if(f!=undefined){var g=new MappingData(f,a.getName(),e.name,h.value);f.addMappingData(g)}})})}else{b[0].data.forEach(function(g){var h=new MappingData(g.node,a.getName(),b[0].name,g.value);a.addMap(h);var e=c.getNodeByDbIdentifier(g.node);if(e!=undefined){var f=new MappingData(e,a.getName(),b[0].name,g.value);e.addMappingData(f)}})}break;case"metaboliteDBIdentifier":b.forEach(function(e){e.data.forEach(function(h){var i=new MappingData(h.node,a.getName(),e.name,h.value);a.addMap(i);var f=c.getNodeByDbIdentifier(h.node);if(f!=undefined){var g=new MappingData(f,a.getName(),e.name,h.value);f.addMappingData(g)}})});break;case"reactionId":if(!(b.length==1&&b[0].name=="undefined")){b.forEach(function(e){e.data.forEach(function(h){var i=new MappingData(h.node,a.getName(),e.name,h.value);a.addMap(i);var f=c.getNodeById(h.node);if(f!=undefined){var g=new MappingData(f,a.getName(),e.name,h.value);f.addMappingData(g)}})})}else{b[0].data.forEach(function(g){var h=new MappingData(g.node,a.getName(),b[0].name,g.value);a.addMap(h);var e=c.getNodeById(g.node);if(e!=undefined){var f=new MappingData(e,a.getName(),b[0].name,g.value);e.addMappingData(f)}})}break;case"metaboliteId":b.forEach(function(e){e.data.forEach(function(h){var i=new MappingData(h.node,a.getName(),e.name,h.value);a.addMap(i);var f=c.getNodeById(h.node);if(f!=undefined){var g=new MappingData(f,a.getName(),e.name,h.value);f.addMappingData(g)}})});break;case"inchi":break;default:metExploreD3.displayMessage("Warning",'The type of node "'+a.getTargetLabel()+"\" isn't know.")}}};
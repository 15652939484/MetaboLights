metExploreD3.GraphLink={link:"",panelParent:"",delayedInitialisation:function(a){metExploreD3.GraphLink.panelParent=a},refreshLink:function(c,g,b,f){metExploreD3.GraphLink.panelParent="#"+c;var e=g.getD3Data();var a=20;var d=b.getMarkerWidth()/2;d3.select("#"+c).select("#D3viz").select("#graphComponent").append("svg:defs").selectAll("marker").data(["in","out"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 0 "+b.getMarkerWidth()+" "+b.getMarkerHeight()).attr("refY",d).attr("markerWidth",b.getMarkerWidth()).attr("markerHeight",b.getMarkerHeight()).attr("orient","auto").append("svg:path").attr("class",String).attr("d","M0,0L"+b.getMarkerWidth()+","+b.getMarkerHeight()/2+"L0,"+b.getMarkerWidth()+"Z").style("visibility","hidden");metExploreD3.GraphLink.link=d3.select("#"+c).select("#D3viz").select("#graphComponent").selectAll("line").data(e.getLinks()).enter().append("line").attr("class","link").attr("marker-end",function(h){if(h.interaction=="out"){d3.select("#"+c).select("#D3viz").select("#graphComponent").select("#"+h.interaction).attr("refX",(f.getWidth()+f.getHeight())/2/2+(b.getMarkerWidth())).style("fill",b.getMarkerOutColor()).style("stroke",b.getMarkerStrokeColor()).style("stroke-width",b.getMarkerStrokeWidth());return"url(#"+h.interaction+")"}else{return"none"}}).attr("marker-start",function(h){if(h.interaction=="out"){return"none"}else{d3.select("#"+c).select("#D3viz").select("#graphComponent").select("#"+h.interaction).attr("refX",-((f.getWidth()+f.getHeight())/2/2)).style("fill",b.getMarkerInColor()).style("stroke",b.getMarkerStrokeColor()).style("stroke-width",b.getMarkerStrokeWidth());return"url(#"+h.interaction+")"}}).style("stroke",b.getStrokeColor())},reloadLinks:function(a,c,b,d){d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("line").data(c.getLinks()).enter().insert("line",":first-child").attr("class","link").attr("marker-end",function(e){if(e.interaction=="out"){d3.select("#"+a).select("#D3viz").select("#graphComponent").select("#"+e.interaction).attr("refX",(d.getWidth()+d.getHeight())/2/2+(b.getMarkerWidth())).style("fill",b.getMarkerOutColor()).style("stroke",b.getMarkerStrokeColor()).style("stroke-width",b.getMarkerStrokeWidth());return"url(#"+e.interaction+")"}else{return"none"}}).attr("marker-start",function(e){if(e.interaction=="out"){return"none"}else{d3.select("#"+a).select("#D3viz").select("#graphComponent").select("#"+e.interaction).attr("refX",-((d.getWidth()+d.getHeight())/2/2)).style("fill",b.getMarkerInColor()).style("stroke",b.getMarkerStrokeColor()).style("stroke-width",b.getMarkerStrokeWidth());return"url(#"+e.interaction+")"}}).style("stroke",b.getStrokeColor()).filter(function(e){return e.interaction!="in"&&e.interaction!="out"}).style("opacity",0)},linkTypeOfMetabolite:function(){_metExploreViz.setLinkedByTypeOfMetabolite(true);var b="viz";var d=_metExploreViz.getSessionById("viz");if(d!=undefined){var c=d.getForce();if(c!=undefined){c.stop()}}var a=metExploreD3.createLoadMask("Link in progress...",b);if(a!=undefined){metExploreD3.showMask(a);metExploreD3.deferFunction(function(){var l={};var m={};var j={};var k={};d3.select("#viz").select("#D3viz").select("#graphComponent").selectAll("line").filter(function(n){return n.getInteraction()!="hiddenForce"}).each(function(n){if(n.getInteraction()=="in"){if(l[n.getTarget()]==null){l[n.getTarget()]=[]}l[n.getTarget()][l[n.getTarget()].length]=n.getSource();if(k[n.getSource()]==null){k[n.getSource()]=[]}k[n.getSource()][k[n.getSource()].length]=n.getTarget()}else{if(m[n.getSource()]==null){m[n.getSource()]=[]}m[n.getSource()][m[n.getSource()].length]=n.getTarget();if(j[n.getTarget()]==null){j[n.getTarget()]=[]}j[n.getTarget()][j[n.getTarget()].length]=n.getSource()}});for(var f in l){var e=-1;l[f].forEach(function(n){e++;l[f].forEach(function(o){if(n!=o&&n!=undefined){metExploreD3.GraphLink.addHiddenLinkInDrawing(n+" -- "+o,n,o,"viz")}});delete l[f][e]})}for(var f in m){var e=-1;m[f].forEach(function(n){e++;m[f].forEach(function(o){if(n!=o&&n!=undefined){metExploreD3.GraphLink.addHiddenLinkInDrawing(n+" -- "+o,n,o,"viz")}});delete m[f][e]})}for(var f in j){var e=-1;j[f].forEach(function(n){e++;j[f].forEach(function(o){if(n!=o&&n!=undefined){metExploreD3.GraphLink.addHiddenLinkInDrawing(n+" -- "+o,n,o,"viz")}});delete j[f][e]})}for(var f in k){var e=-1;k[f].forEach(function(n){e++;k[f].forEach(function(o){if(n!=o&&n!=undefined){metExploreD3.GraphLink.addHiddenLinkInDrawing(n+" -- "+o,n,o,"viz")}});delete k[f][e]})}metExploreD3.hideMask(a);var g=metExploreD3.GraphNetwork.isAnimated(d.getId());if(g=="true"){var h=d.getForce();if(h!=undefined){if((metExploreD3.GraphNetwork.isAnimated(d.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(d.getId())==null)){h.start()}}}},100)}},removeLinkTypeOfMetabolite:function(){_metExploreViz.setLinkedByTypeOfMetabolite(false);var b="viz";var d=_metExploreViz.getSessionById("viz");if(d!=undefined){var c=d.getForce();if(c!=undefined){c.stop()}}var a=metExploreD3.createLoadMask("Remove hidden link in progress...",b);if(a!=undefined){metExploreD3.showMask(a);metExploreD3.deferFunction(function(){metExploreD3.GraphLink.removeHiddenLinkInDrawing("viz");metExploreD3.hideMask(a);var e=metExploreD3.GraphNetwork.isAnimated(d.getId());if(e=="true"){var f=d.getForce();if(f!=undefined){if((metExploreD3.GraphNetwork.isAnimated(d.getId())=="true")||(metExploreD3.GraphNetwork.isAnimated(d.getId())==null)){f.start()}}}},100)}},addHiddenLinkInDrawing:function(g,a,f,b){var j=_metExploreViz.getSessionById(b);var d=j.getD3Data();d.addLink(g,a,f,"hiddenForce",false);var h=metExploreD3.getMetaboliteStyle();var e=metExploreD3.getLinkStyle();var c=j.getForce();link=d3.select("#"+b).select("#graphComponent").selectAll("line").data(c.links(),function(k){return k.source.id+"-"+k.target.id}).enter().insert("line",":first-child").attr("class","link").style("stroke",e.getStrokeColor()).style("opacity",0)},removeHiddenLinkInDrawing:function(b){var f=_metExploreViz.getSessionById(b);var e=f.getD3Data();var a=[];var d=f.getForce();var c=d3.select("#"+b).select("#graphComponent").selectAll("line").filter(function(g){return g.getInteraction()=="hiddenForce"}).each(function(g){a.push(g)}).remove();setTimeout(function(){for(i=0;i<a.length;i++){var h=a[i];e.removeLink(h);var g=d.links().indexOf(h);if(g!=-1){d.links().splice(g,1)}}},100)},tick:function(a,c){metExploreD3.GraphLink.displayConvexhulls(a);if(metExploreD3.GraphNetwork.isAnimated(a)=="true"&&c.getZoomScale()<0.7&&d3.select("#"+a).select("#D3viz").select("#graphComponent").select("defs").selectAll("marker").selectAll("path").style("visibility")=="visible"){d3.select("#"+a).select("#D3viz").select("#graphComponent").select("defs").selectAll("marker").selectAll("path").style("visibility","hidden")}var b=_metExploreViz.getSessionById(a);if((b.getForce().alpha()==0&&d3.select("#"+a).select("#D3viz").select("#graphComponent").select("defs").selectAll("marker").selectAll("path").style("visibility")=="hidden")||(c.getZoomScale()>0.7&&d3.select("#"+a).select("#D3viz").select("#graphComponent").select("defs").selectAll("marker").selectAll("path").style("visibility")=="hidden")){d3.select("#"+a).select("#D3viz").select("#graphComponent").select("defs").selectAll("marker").selectAll("path").style("visibility","visible")}d3.select("#"+a).select("#D3viz").select("#graphComponent").selectAll("line").attr("x1",function(e){return e.source.x}).attr("y1",function(e){return e.source.y}).attr("x2",function(e){return e.target.x}).attr("y2",function(e){return e.target.y})},displayConvexhulls:function(a){var b=_metExploreViz.getGeneralStyle();var c=d3.select("#"+a).select("#D3viz").selectAll("path").filter(function(e){return e!="in"&&e!="out"});if(b.isDisplayedConvexhulls()){if(c[0].length==0){metExploreD3.GraphNode.loadPath(a)}c.attr("d",metExploreD3.GraphNode.groupPath).attr("transform",d3.select("#"+a).select("#D3viz").select("#graphComponent").attr("transform"))}else{c.remove()}},loadLink:function(c,g,b,f){metExploreD3.GraphLink.panelParent="#"+c;var e=g.getD3Data();var a=20;var d=b.getMarkerWidth()/2;d3.select("#"+c).select("#D3viz").select("#graphComponent").append("svg:defs").selectAll("marker").data(["in","out"]).enter().append("svg:marker").attr("id",String).attr("viewBox","0 0 "+b.getMarkerWidth()+" "+b.getMarkerHeight()).attr("refY",d).attr("markerWidth",b.getMarkerWidth()).attr("markerHeight",b.getMarkerHeight()).attr("orient","auto").append("svg:path").attr("class",String).attr("d","M0,0L"+b.getMarkerWidth()+","+b.getMarkerHeight()/2+"L0,"+b.getMarkerWidth()+"Z").style("visibility","hidden");metExploreD3.GraphLink.link=d3.select("#"+c).select("#D3viz").select("#graphComponent").selectAll("line").data(e.getLinks()).enter().append("line").attr("class","link").attr("marker-end",function(h){if(h.interaction=="out"){d3.select("#"+c).select("#D3viz").select("#graphComponent").select("#"+h.interaction).attr("refX",(f.getWidth()+f.getHeight())/2/2+(b.getMarkerWidth())).style("fill",b.getMarkerOutColor()).style("stroke",b.getMarkerStrokeColor()).style("stroke-width",b.getMarkerStrokeWidth());return"url(#"+h.interaction+")"}else{return"none"}}).attr("marker-start",function(h){if(h.interaction=="out"){return"none"}else{d3.select("#"+c).select("#D3viz").select("#graphComponent").select("#"+h.interaction).attr("refX",-((f.getWidth()+f.getHeight())/2/2)).style("fill",b.getMarkerInColor()).style("stroke",b.getMarkerStrokeColor()).style("stroke-width",b.getMarkerStrokeWidth());return"url(#"+h.interaction+")"}}).style("stroke",b.getStrokeColor());metExploreD3.GraphLink.link.filter(function(h){return h.getInteraction()=="hiddenForce"}).style("opacity",0)}};